# GeoJSON 地图编辑器 - 更新日志

本文档记录 GeoJSON 地图编辑器的所有版本更新，从新到旧排列。

---

## [v2.3.0] - 2026-01-09

### ✨ 新功能

#### 组合标记与放射展开 (Spiderfy)
- **组合显示**
  - 同坐标多标记自动合并为组合标记
  - 组合标记显示红色数量徽标（如 "3"）
  - 坐标判定阈值可配置（`COORD_EPSILON = 1e-6`）
- **放射展开**
  - 点击组合标记以圆形/蝗旋布局展开子标记
  - 展开后各子标记可独立选中、编辑
  - 连接线动画效果
- **收起触发**
  - ESC 键收起
  - 点击地图空白处收起
  - 再次点击组合标记收起
- **数据安全**
  - 展开/收起仅影响显示，不修改 GeoJSON 原始坐标
  - 导出时自动还原原始坐标

### 📦 文件变更
- `marker-group.js` - 新建（~350行）
- `style.css` - 添加组合标记样式（~90行）
- `script.js` - 集成 MarkerGroupManager
- `table-view.js` - 支持分组标记枚举与展开
- `index.html` - 引入 marker-group.js

## [v2.2.1] - 2026-01-09

### 🐛 关键修复
- **中文字段深度支持**
  - 属性编辑器优先识别中文字段（名称/类型/地址）作为标题
  - 表格视图实现**动态列生成**，自动显示所有业务字段
  - 地图气泡弹窗同步支持中文字段
- **气泡弹窗与按钮修复**
  - 修复左键点击冲突，现在点击标记可同时触发高亮与气泡弹出
  - 修复弹窗内“添加事件”按钮无效的问题，统一 ID 引用逻辑
  - 统一所有导入路径（GeoJSON/Excel/CSV）的气泡绑定逻辑

## [v2.2.0] - 2026-01-09

### 🐛 关键修复

#### 中文字段完整支持
- **修复字段过滤逻辑**
  - 只过滤内部技术字段（`_*`、`marker-*`、`events`）
  - 所有中英文业务字段完整显示
  - 支持：销售等级、加油笔数、钱包会员比例等
- **同步修复**
  - property-editor.js - 属性抽屉
  - table-view.js - 表格视图

#### 右键属性编辑器修复
- 右键点击时设置 `selectedMarker`
- 确保属性编辑器正确获取标记引用
- 与地图高亮状态保持一致

#### 左键事件功能增强
- 左键点击：高亮标记 + 设置选中
- Ctrl+左键：打开属性抽屉
- **双击标记**：打开事件追踪器（新增）

### 📝 文件变更
- `property-editor.js` - 字段过滤重构（~20行）
- `table-view.js` - 同步过滤逻辑（~15行）
- `script.js` - 事件绑定修复（~10行）

---

## [v2.1.0] - 2026-01-08

### ✨ 新功能

#### 表格视图面板
- **Tabulator 集成**
  - 使用 Tabulator.js 专业表格库
  - 虚拟滚动支持（优化大数据集性能）
  - 每个 Feature 独立一行
- **表格功能**
  - 列排序、列筛选
  - 单元格编辑回写
  - 隐藏列支持
- **双向联动**
  - 表格行点击 → 地图定位并高亮
  - 地图选中 → 表格行高亮

### 📝 文件变更
- `table-view.js` - 新建（300+ 行）
- `table-view-styles.css` - 新建（150+ 行）
- `index.html` - 引入 Tabulator + 容器

---

## [v2.0.0] - 2026-01-08

### 🎉 重大更新

#### 标记交互系统重构
- 左键单击：高亮标记（金色脉冲）
- Ctrl + 左键：打开属性抽屉
- 右键菜单：保留所有功能

#### 属性编辑器全新设计
- 侧边抽屉替代 Modal
- 固定高度（max 800px）
- 新增：地址、坐标显示、图标预览
- 快捷操作按钮

#### 同位置多标记支持
- 自动圆形偏移布局
- 保存原始坐标
- 导入/导出完整支持

---

## [v1.2.0] - 2026-01-08

### 🐛 修复

#### 服务器启动问题
- 智能端口检测（8000-8099）
- 避免端口冲突错误

### 📦 新增文件
- `server.py` - 智能 HTTP 服务器

---

## [v1.0.0] - 基础版本

### ✨ 核心功能
- 地图编辑（标记、线条、多边形）
- 自定义图标与颜色
- GeoJSON 导入/导出
- 事件追踪器
- 无限命名存档
- 多种底图切换
